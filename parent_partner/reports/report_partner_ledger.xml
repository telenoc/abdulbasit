<?xml version="1.0" encoding="utf-8" ?>


<odoo>

    <template id="report_partnerledger">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-set="data_report_margin_top" t-value="12"/>
                <t t-set="data_report_header_spacing" t-value="9"/>
                <t t-set="data_report_dpi" t-value="110"/>
                <t t-set="is_start" t-value="True"/>
                <t t-foreach="parent" t-as="parent" t-lang="res_company.partner_id.lang">
                    <div class="page">

                        <div class="row">
                            <div class="col-6">
                                <strong>Account statement for:</strong>
                                <span t-esc="parent.name"/>
                            </div>
                            <div class="col-3">
                                <strong>Date from :
                                    <span t-esc="data['form']['date_from']"/>
                                </strong>
                            </div>
                            <div class="col-3">
                                <strong>Date to :
                                    <span t-esc="data['form']['date_to']"/>
                                </strong>
                            </div>

                        </div>


                        <table class="table table-sm table-reports">
                            <thead>
                                <tr>
                                    <th style="text-align:center;background-color:#dcdcdc;">
                                        Date
                                    </th>
                                    <th style="text-align:center;background-color:#dcdcdc;">
                                        Sub Account (Child)
                                    </th>
                                    <th style="text-align:center;background-color:#dcdcdc;">
                                        Ref
                                    </th>
                                    <th style="text-align:center;background-color:#dcdcdc;">
                                        Debit
                                    </th>
                                    <th style="text-align:center;background-color:#dcdcdc;">
                                        Credit
                                    </th>
                                    <th style="text-align:center;background-color:#dcdcdc;">
                                        Balance
                                    </th>
                                    <th style="text-align:center;background-color:#dcdcdc"
                                        t-if="data['form']['amount_currency']">Currency
                                    </th>
                                </tr>
                            </thead>
                            <t t-set="total_credit" t-value="0"/>
                            <t t-set="total_debit" t-value="0"/>
                            <t t-set="total_balance" t-value="0"/>
                            <t t-set="balance" t-value="0"/>
                            <t t-set="is_start" t-value="True"/>
                            <t t-foreach="docs" t-as="o">

                                <t t-set="total_debit" t-value="total_debit+sum_partner(data, o, 'debit')"/>
                                <t t-set="total_credit" t-value="total_credit+sum_partner(data, o, 'credit')"/>
                                <t t-set="total_balance" t-value="total_balance+balance"/>
                                <tbody>

                                    <tr t-foreach="lines(data, o)" t-as="line">
                                        <t t-set="balance" t-value="balance+(line['debit'] - line['credit'])"/>
                                        <td style="text-align:center;">
                                            <span t-esc="line['date']"/>
                                        </td>
                                        <td style="text-align:center;">
                                            <t t-if='parent.name != o.name'>
                                                <strong t-esc="o.name" t-lang="lang"/>
                                            </t>
                                        </td>
                                        <t t-set="lang" t-value="o.partner_id.lang"/>


                                        <td style="text-align:center;">
                                            <t t-if="not is_start">
                                                <span t-esc="line['name']"/>
                                            </t>
                                            <t t-else="">
                                                <t t-set="is_start" t-value="False"/>
                                                <span>Starting Balance</span>
                                            </t>
                                        </td>
                                        <td style="text-align:center;">
                                            <span t-esc="line['debit']"/>
                                        </td>
                                        <td style="text-align:center;">
                                            <span t-esc="line['credit']"/>
                                        </td>
                                        <td style="text-align:center;">
                                            <t t-esc="balance" t-options='{"widget": "float", "precision": 2}'/>

                                        </td>
                                        <td style="text-align:center" class="text-right"
                                            t-if="data['form']['amount_currency']">
                                            <t t-if="line['currency_id']">
                                                <span t-esc="line['amount_currency']"
                                                      t-options="{'widget': 'monetary', 'display_currency': line['currency_id']}"/>
                                            </t>
                                        </td>
                                    </tr>
                                </tbody>
                            </t>
                            <tr>
                                <td colspan="3"
                                    style="text-align:Left;background-color:#dcdcdc;">
                                    <strong>Total</strong>
                                </td>

                                <td style="text-align:center;background-color:#dcdcdc;">
                                    <t t-esc="total_debit" t-options='{"widget": "float", "precision": 2}'/>
                                </td>
                                <td style="text-align:center;background-color:#dcdcdc;">
                                    <t t-esc="total_credit" t-options='{"widget": "float", "precision": 2}'/>
                                </td>
                                <td style="text-align:center;background-color:#dcdcdc;">
                                    <t t-esc="balance" t-options='{"widget": "float", "precision": 2}'/>
                                </td>
                            </tr>
                        </table>
                    </div>

                </t>
            </t>
        </t>
    </template>

</odoo>
